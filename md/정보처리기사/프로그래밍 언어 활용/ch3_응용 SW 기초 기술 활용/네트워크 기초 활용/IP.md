# IP(Internet Protocol)

---

## IP 개념
- 송신 호스트와 수신 호스트가 패킷 교환 네트워크(Packet Switching Network)에서 정보를 주고받는 데 사용하는 정보 위주의 규약
- OSI 3계층인 네트워크 계층에서 호스트의 주소 지정과 패킷 분할 및 조립 기능을 담당
- IP의 정보는 패킷 혹은 데이터그램이라고 하는 덩어리로 나뉘어 전송

## IP 특징

- **비신뢰성(Unreliable), 비연결형(Connection less)**
  - 흐름에 관여하지 않기 때문에 보낸 정보가 제대로 갔는지 보장하지 않는다는 뜻
  - 패킷 전송과 정확한 순서를 보장하려면 TCP 프로토콜과 같은 IP의 상위 프로토콜을 이용해야 함
  - 신뢰성이 중요한 전송에는 IP+TCP 활용
- **에러 제어와 흐름 제어가 없음**
  - 정보의 전송이 가장 중요
  - 보낸 정보의 내용을 보장해 주지는 않음
  - 패킷은 에러 검출만하고 만일 발견되면 폐기
- **대표적인 IP 주소체계**
  - 현재 인터넷에서 사용하는 표준 프로토콜은 IPv4
  - 주소 공간 고갈 문제를 겪고 있어 IPv6가 점차 확산
- **IP 크기 제한**
  - IP 크기는 20~40 바이트
  - IP 패킷은 네트워크가 수용할 수 있는 크기로 분할되어야 하는데, 이를 단편화(Fragmentation)라 함
  - 인터넷으로 데이터를 전송 시에는 IP 패킷을 잘라서 보내고, 이런 단편화는 MTU(Maximum Transfer Unit; 인터넷에서 최대로 보낼 수 있는 메시지 단위) 때문에 필요


## IPv4(Internet Protocol Version 4)

### 1. IPv4 개념
- 인터넷에서 사용되는 패킷 교환 네트워크상에서 데이터를 교환하기 위한 32비트 주소체계를 갖는 네트워크 계층의 프로토콜

### 2. IPv4 헤더(Header)
- IP 패킷의 앞부분에서 주소 등 각종 제어정보를 담고 있는 부분
- IPv4 헤더 사이즈는 옵션 미지정시 최소 20바이트 이상 (IPv6의 경우 최소 40바이트 이상)

**IPv4 헤더 구조[버헤타토 아플프 타플체 소데]**
- Version Number
  - IP 프로토콜의 버전 번호
- Header Length
  - IP 프로토콜의 헤더 길이를 4바이트 단위로 나타내는 필드
- Type of Service(ToS)
  - IP 패킷이 가지는 서비스 형태를 나타내는 필드
- Packet Length
  - IP를 포함한 패킷 전체 길이를 바이트 단위로 표시하는 필드
  - IP 패킷의 길이는 0 ~ 65535바이트
- Identification
  - 단편화 시에 필요하며 조각이 동일 패킷이면 같은 일련번호를 갖는 필드
- Flag
  - 단편화 시에 필요하며, 처음 1비트는 항상 0으로 설정, 나머지 2비트는 단편화 설정
- Fragment Offset
  - 단편화 시에 필요하며, 전체 패킷에서 해당 단편이 차지하는 위치 값을 의미
- Time To Live(TTL)
  - 송신 호스트가 패킷을 전송하기 전 네트워크에서 생존할 수 있는 시간을 표시하는 필드
  - 패킷이 각 라우터를 지나갈 때마다 1씩 감소
- Protocol
  - IP 계층 위에서 존재하는 상위 프로토콜이 무엇인지 나타내는 필드
- Header Checksum
  - 헤더의 오류를 검사하는 필드
- Source Address
  - 출발지 IP 주소를 나타내는 필드
- Destination Address
  - 목적지 IP 주소를 나타내는 필드


### 3. IPv4 주소체계
- IPv4의 주소체계는 10진수로 총 12자리이며, 네 부분으로 나뉨
- 각 부분은 10진수 0부터 255까지 3자리의 수로 표현
- 32비트 IP주소는 Network를 나타내는 부분과 Host를 나타내는 부분으로 구성
- Network 부분과 Host 부분을 구분하는 것은 서브넷 마스크(Subnet Mask)이다.

**1) IPv4 네트워크 클래스**

- **A 클래스**
  - A 클래스는 가장 높은 단위의 클래스
  - 1 ~ 126 (0.127로 시작된 IP는 예약됨) 범위의 IP 주소를 가짐
  - 두 번째, 세 번째, 네 번쨰 단위의 세 숫자는 A Class가 자유롭게 네트워크 사용자에게 부여가 가능한 IP
  - 범위
    - 0.0.0.0 ~ 127.255.255.255 (서브넷 마스크 : 255.0.0.0)
- **B 클래스**
  - B 클래스는 두 번쨰로 높은 단위의 클래스
  - 첫 번째 단위의 세 숫자는 128~191 가운데 하나를 가짐
  - 두 번째 단위의 세 숫자는 B Class가 접속할 수 있는 네트워크를 지시
  - 범위
    - 128.0.0.0 ~ 191.255.255.255 (서브넷 마스크 : 255.255.0.0)
- **C 클래스**
  - C 클래스는 최하위 클래스
  - 아이피 구성에서 첫 번째 단위의 세 숫자는 192 ~ 223 가운데 하나를 가짐
  - 두 번째와 세 번쨰 단위의 세 숫자는 C Class가 접속 할 수 있는 네트워크를 지시
  - C Class가 자유로이 부여할 수 있는 아이피는 마지막 네 번쨰 단위의 254개(2개는 예약)
  - 범위
    - 192.0.0.0 ~ 223.255.255.255 (서브넷 마스크 : 255.255.255.0)
- **D 클래스**
  - 멀티캐스트 용도로 예약된 주소
  - 범위
    - 224.0.0.0 ~ 239.255.255.255
  - **E 클래스**
    - 연구를 위해 예약된 주소
    - 범위
      - 240.0.0.0 ~ 255.255.255.255

**2) IPv4 주소 체계 - CIDR**
- 클래스 없는 도메인 간 라우팅 기법 
- 1993년 도입되기 시 작한 IP 주소 할당 방법
- CIDR을 이용하면 네트워크 ID로 사용하는 범위를 자유롭게 표기할 수 있게 되어 네트워크를 조금 더 세부적인 단위로 쪼갤 수 있음
- CIDR의 표기 방법
- (IP주소)/(네트워크 ID 비트 수)

### 4. 서브네팅(Subnetting)
**1) 서브네팅 개념**
- IP 주소 고갈문제를 해결하기 위해 원본 네트워크를 여러 개의 네트워크로 분리하는 과정
- 대표 네트워크 IP 주소일 경우 호스트 ID는 2진수 기준으로 모두 0을 채워 넣고
- 브로드 캐스트 IP 주소일 경우 호스트 ID는 2진수 기준으로 모두 1을 채워 넣음

**2) 서브네팅 종류**

- **FLSM(Fixed-Length Subnet Masking)**
  - 서브넷의 길이를 고정적으로 사용
  - 한 대역을 동일한 크기로 나누는 방식
- **VLSM(Variable Length Subnet Masking)**
  - 서브넷의 길이를 가변적으로 사용
  - 한 대역을 다양한 크기로 나누는 방식


## IPv6(Internet Protocol version 6)

### 1. IPv6 개념
- 인터넷 프로토콜 스택 중 네트워크 계층의 프로토콜
- 현재 IPv4가 가지고 있는 주소 고갈, 보안성, 이동성 지원 등의 문제점을 해결하기 위해 개발된 128bit 주소쳬게를 갖는 차세대 인터넷 프로토콜

### 2. IPv6 특징
- **IP 주소의 확장**
  - IPv4의 기존 32비트 주소 공간에서 벗어나, IPv6는 128비트 주소 공간 제공
- **이동성**
  - IPv6 호스트는 네트워크의 물리적 위치에 제한받지 않고 같은 주소를 유지하면서도 자유롭게 이동 가능
- **인증 및 보안 기능**
  - 패킷 출처 인증과 데이터 무결성 및 비밀 보장 기능을 IP 프로토콜 체계에 반영
  - IPSec 기능적용 및 IPv4보다 보안성 강화
- **개선된 QoS 지원**
  - 흐름 레이블(Flow Label) 개념을 도입, 특정 트래픽은 별도의 특별한 처리(실시간 통신 등)를 통해 높은 품질의 서비스를 제공
- **Plug&Play 지원**
  - IPv6 호스트는 IPv6 네트워크에 접속하는 순간 자동적으로 네트워크 주소를 부여받음
  - 멀티미디어의 실시간 처리가 가능
- **Ad-hoc 네트워크 지원**
  - Ad-hoc 네트워크를 위한 자동 네트워킹 및 인터넷 연결 지원
  - 자동으로 네트워크 환경 구성이 가능
- **단순 헤더 적용**
  - IP 패킷의 처리를 신속하게 할 수 있도록 고정 크기의 단순 헤더를 사용
  - 확장 헤더를 토해 기능에 대한 확장 및 옵션 기능의 사용이 용이한 구조
- **실시간 패킷 추적 가능**
  - 흐름 레이블(Flow Label)을 사용하여 패킷의 흐름을 실시간 제공

### 3. IPv6 헤더(Header)
- 기존 IPv4 헤더에 비해 IPv6 출발지 주소, 목적지 주소의 주소 길이로 인하여 커졌고 IPv4의 불필요한 필드를 제거함으로 헤더가 단순


- **IPv6 헤더 구조[버트플 페넥홉 소데]**
  - Version
  - Traffic Class
  - Flow Label
  - Payload Length
  - Next Header
  - Hop Limit
  - Source Address
  - Destination Address


### 4. IPv6 주소체계
- 128비트의 주소 공간 제공
- 일반적으로 16비트 단위로 나누어지며 각 16비트 블록은 다시 4자리 16진수로 변환되고 콜론으로 구분
- 64비트를 기준으로 앞 64비트를 네트워크 주소로, 뒤 64비트를 네트워크에 연결된 랜카드 장비 드에 할당하는 인터페이스 주소로 활용
- IPv6의 128비트 주소 공간은 128비트로 표현할 수 있는 2(128제곱)개인 약 3.4 * 10(38제곱)개의 주소를 갖고 있어 거의 무한대로 쓸 수 있음
- 128비트 주소 공간은 16비트(2옥텟)를 16진수로 표현하여 8자리로 나타냄
- 2001:0db8:85a3:08d3:1319:8a2e:0370:7334
- 대부분의 자리가 0의 숫자를 갖게 되므로, 0000을 하나의 0으로 축약하거나, 혹은 아예 연속되는 0의 그룹을 없애고 ':' 만을 남길 수 있음


## IPv4와 IPv6 특징

- **IPv4**
  - 주소 길이 : 32bit
  - 표시 방법 : 8비트씩 4부분으로 나뉜 10진수
  - 주소 개수 : 약 43억 개
  - 주소 할당 : A, B, C, D 등 클래스 단위 비순차적 할당
  - 헤더 크기 : 20바이트의 기본 헤더 부분과 가변적 길이를 가지고 있는 옵션 부분으로 구성
  - QoS : Best Effort 방식(ㅗㅂ장 곤란)
  - 보안 기능 : IPsec 프로토콜 별도 설치
  - Plug & Play : 지원 안함
  - 모바일 IP : 곤란
  - 웹 캐스팅 : 곤란
  - 전송 방식 : 멀티 캐스트, 유니 캐스트, 브로드 캐스트

- **IPv6**
  - 주소 길이 : 128bit
  - 표시 방법 : 16비트씩 8부분으로 나뉜 16진수
  - 주소 개수 : 2(128) = 4.3 * 10(38)
  - 주소 할당 : 네트워크 규모 및 단말기 수에 따른 순차적 할당(효율적)
  - 헤더 크기 : 40바이트의 고정된 길이
  - QoS : 등급별, 서비스별 패킷 구분 보장
  - 보안 기능 : 보안과 인증 확장 헤더를 사용함으로써 인터네 계층의 보안 기능을 강화
  - Plug & Play : 지원
  - 모바일 IP : 용이
  - 웹 캐스팅 : 용이
  - 전송 방식 : 유니 캐스트, 멀티 캐스트, 애니 캐스트

## IPv4에서 IPv6으로 전환 방법[듀터주]
- IPv4 전용호스트와 IPv6 전용호스트 간의 통신을 위한 기술
- 주소와 헤더의 변환 수행
- NAT-PT(Network Address Translation-Protocol Translation) 주소 변환 기술 중 하나

### 1. 듀얼 스택(Dual Stack)
- IP 계층에 두 가지의 프로토콜이 모두 탑재되어 있고 통신 상대방에 따라 해당 IP 스택을 선택하는 방법


**장점**
- DNS 주소 해석 라이브러리가 두 IP 주소 유형을 모두 지원

**단점**
- 프로토콜 스택 수정으로 인한 과다한 비용 발생


### 2. 터널링(Tunneling)
- IPv6 망에서 인접한 IPv4 망을 거쳐 다른 IPv6 망으로 통신할 때 
- IPv4 망에 터널을 만들고 IPv4에서 사용하는 프로토콜로 캡슐화하여 전송하는 방법

- **장점**
  - 여러 표준화 활동 존재하고 다양한 기술 표준이 제안되고 있음
- **단점**
  - 구현이 어려우며, 복잡한 동작 과정을 가짐

### 3. 주소변환(Address Translation)
- IPv4 망과 IPv6 망 사이에 주소변환기(IPv4-IPv6 게이트웨이)를 사용하여 서로 다른 네트워크상의 패킷을 변환시키는 방법

**장점**
- IPv4, IPv6 호스트의 프로토콜 스택에 대한 수정이 필요 없으며, 변환방식이 투명하고 구현이 용이

**단점**
- 고가의 주소 변환기 필요

- 주소변환 방식은 게이트웨이 관점이라고도 함
- 게이트웨이 관점의 IPv4/IPv6 변환방식은 변환방법에 따라서 헤더 변환방식, 전송 계층 릴레이 방식, 응용 계층 게이트웨이 방식으로 분류


## 라우팅 프로토콜(3계층)

- 데이터 전송을 위해 목적지까지 갈 수 있는 열 경로 중 최적의 경로를 설정 해주는 라우터 가느이 상호 통신규약

> - 내부 라우팅 프로토콜(IGP; Interior Gateway Protocol)
>   - 동일한 AS(Autonomous System; 자치 시스템, 자율시스템) 내의 라우팅에 사용되는 프로토콜
> - 외부 라우팅 프로토콜(EGP; Exterior Gateway Protocol)
>   - 서로 다른 AS 간 라우팅 프로토콜로 게이트웨이 간의 라우팅에 사용
> 
> 
> - 정적 라우팅은 패킷 전송이 이루어지기 전에 경로 정보를 라우터가 미리 저장하여 중개하는 방식
> - 동적 라우팅은 라우터의 경로 정보가 네트워크 상황에 따라 동적으로 변경되어 중개하는 방식

### 1. RIP(Routing Information Protocol)

**1) RIP 개념**
- RIP는 AS(Autonomous System; 자치시스템, 자율 시스템) 내에서 사용하는 거리 벡터 알고리즘에 기초하여 개발된 내부 라우팅 프로토콜

**2) RIP 특징**
- **벨만-포드 알고리즘 사용**
  - Bellman-Ford 알고리즘 사용하는 내부 라우팅 프로토콜
  - 거리 벡터 라우팅 기반 메트릭(Metric; 라우팅 프로토콜들이 최적 경로를 선택하는 기준으로 최적 경로 선택 기준값) 정보를 인접 라우터와 주기적으로 교환하여 라우팅 테이블을 갱신하고 라우팅 테이블을 구성 계산
- **15홉 제한**
  - 최대 홉 수(Hop Count)를 15개로 제한
- **UDP 사용**
  - UDP 포트 번호 520 사용
- **30초마다 정보 공유**
  - 30초마다 전체 라우팅 정보를 브로드캐스팅


### 2. OSPF(Open Shortest Path First)

**1) OSPF 개념**
- 규모가 크고 복잡한 TCP/IP 네트워크에서 RIP의 단점을 개선하기 위해 자신을 기준으로 링크 상태 알고리즘 적용
- 최단 경로를 찾는 라우팅 프로토콜

**2) OSPF 특징**

- **다익스트라 알고리즘 사용**
  - 최단 경로 탐색에 다익스트라(Dijkstra) 알고리즘 사용하는 내부 라우팅 프로토콜
  - 링크 상태 라우팅 기반 메메트릭 정보를 한 지역 내 모든 라우터에 변경이 발생했을 때만 보내고 라우팅 테이블을 구성 계산
  - 네트워크 변화에 신속하게 대처
- **라우팅 메트릭 지정**
  - 최소 지연, 최대 처리량 등 관리자가 라우팅 메트릭 지정
- **AS 분할 사용**
  - 자치 시스템을 지역으로 나누어 라우티을 효과적으로 관리
- **홉 카운트 무제한**
  - 홉 카운트에 제한이 없음
- **멀티캐스팅 지원**
  - 멀티캐스트를 사용하여 정보를 전달

### 3. BGP(Border Gateway Protocol)

**1) BGP 개념**
- AS 상호 간(Inter-AS 또는 Inter-Domain)에 경로 정보를 교환하기 위한 라우팅 프로토콜

**2) BGP 특징**
- 변경 발생 시 대상까지의 가장 짧은 경로를 경로 백터(Path Vector) 알고리즘을 토해 선정
- TCP 연결(port 179)을 토해 자치 시스템으로 라우팅 정보를 신뢰성 있게 전달
- ISP 사업자들 상호 간에 주로 사용되는 라우팅 프로토콜
- 순환을 피할 수 있도록 목적지까지 가는 경로 정보를 제공
- 라우팅 비용(CPU 부하)이 많이 들고, 라우팅 테이블의 크기가 커서 메모리 사용량이 많음




